```{r}
datos <- data.frame(var1=rpois(50, 6), var2=rgamma(50, shape=5,rate=.4), var3=rnorm(50, 10))
datos %>% 
    select(var2) %>% 
    as.list %>% 
    names
```

```{r, eval=FALSE}
library(correlation)
library(corrr)
#CORRELACIONES PARA VER DESPUÃ‰S
#https://journals.sagepub.com/doi/pdf/10.1177/8756479308317006
corre <- base %>% 
  dplyr::select(i1_m1:i35_m1) %>% 
  rename_all(function(x) substr(x, 1, nchar(x)-3)) %>% 
  correlation(method = "tetrachoric") %>% 
  summary(redundant = TRUE) %>%
  as.data.frame()
row.names(corre) <- corre$Parameter
corre <- corre[,-1]
corre <- as.matrix(corre)

network_plot(corre, min_cor=.5, colours = c("red", "white", "blue"))

correlation(na.omit(starwars), method = "auto")

df <- carData::Salaries %>% 
    mutate(ordi=factor(sample(1:5, 397, replace = TRUE), ordered = TRUE))

df <- data.frame(cont1=rnorm(100), 
                 cont2=rnorm(100),
                 ordi1=factor(sample(1:5, 100, replace = TRUE), ordered = TRUE),
                 ordi2=factor(sample(1:7, 100, replace = TRUE), ordered = TRUE),
                 bin1=rbinom(100, 1, .4),
                 bin2=rbinom(100, 1, .6),
                 nomi1=factor(sample(letters[1:8], 100, replace = TRUE)),
                 nomi2=factor(sample(LETTERS[1:8], 100, replace = TRUE)))


```

```{r}
clases <- function(data){
    class1 <- lapply(data, class)
    
    #Continuous variables
    cont_vars <- sapply(class1, function(x){
        sum(x %in% c("numeric", "double", "integer"))
    })
    cont_vars <- which(cont_vars>=1)
    
    cont_vars <- cont_vars[sapply(data[,cont_vars], function(x){
        (sum((x%%1)<1 & (x%%1)>0)>nrow(data)*.20) | (length(table(x))>2)
    })]
    #Binary variables
    bin_vars <- sapply(class1, function(x){
        sum(x %in% c("numeric", "double", "integer", "factor", "ordered"))
    })    
    
    bin_vars <- which(bin_vars>=1)
    
    bin_vars <- bin_vars[sapply(data[,bin_vars], function(x){
        (length(table(x))=="2")
    })]
    #Ordinal variables
    ord_vars <- sapply(class1, function(x){
        sum(x %in% c("factor", "ordered"))
    })
    
    ord_vars <- which(ord_vars>=1)
    
    ord_vars <- ord_vars[sapply(data[,ord_vars], function(x){
        ("ordered" %in% class(x)) | (if(sum(grepl("\\D", levels(x)))<1){
            if(length(which(diff(as.numeric(levels(x))) != 1))<1){
                TRUE
            }else(FALSE)
        }else(FALSE))
    })]
    #Nominal variables
    nom_vars <- sapply(class1, function(x){
        sum(x %in% c("factor"))
    })
    
    nom_vars <- which(nom_vars>=1)
    
    nom_vars <- nom_vars[sapply(data[,nom_vars], function(x){
        ("ordered" %nin% class(x)) & (sum(grepl("\\D", levels(x)))>0)
    })]
    
    types <- list(continuous = names(cont_vars), 
         binary = names(bin_vars),
         ordinal = names(ord_vars),
         nominal = names(nom_vars))
    
    types <- lapply(types, function(x){
        as.data.frame(x)
    }) %>% 
        do.call(rbind, .) %>% 
        mutate(class=unlist(mapply(rep, names(types), sapply(types, length), SIMPLIFY = FALSE))) %>% 
        rename("variable"="x")
    
    stages <- as.data.frame(t(combn(types$variable, 2))) %>% 
        left_join(.,types, by=c("V1"="variable")) %>% 
        rename(V1_class=class) %>% 
        left_join(.,types, by=c("V2"="variable")) %>% 
        rename(V2_class=class)
    
    cor_types <- data.frame(V1_class=c("continuous", "continuous", "continuous", "continuous", "ordinal", 
                                       "ordinal", "ordinal", "binary", "binary", "nominal"),
                            V2_class=c("continuous", "ordinal", "binary", "nominal", "ordinal",
                                       "binary", "nominal", "binary", "nominal", "nominal"),
                            cor_type=c("pearson", "kendall", "biserial", "biserial", "polychoric",
                                       "rank-biserial", "rank-biserial", "tetrachoric", "kruskal", "kruskal"))
    
   
    
    left_join(stages, cor_types, by=c("V1_class", "V2_class"))
    

}

clases(df)
library(rcompanion)
data(Catbus)
wilcox.test(Steps ~ Sex, data = Catbus)
wilcoxonRG(x = Catbus$Steps, g = Catbus$Sex)
```


```{r}
#method="pearson"
#method="kendall"
#method="spearman"
#method="biserial"
#method="polychoric"
#method="tetrachoric"
#method="biweight"
#method="distance"
#method="percentage"
#method="shepherd"

```


```{r}
descriptive_plot <- function(data,...){
    vars <- select(data,...) %>% 
        as.list
    
    plot_fun <- function(variables){
        dens1 <- density(variables)
        
        pos_median <- which(dens1$x>=quantile(variables, .25) & dens1$x <= quantile(variables, .75))
        
        sigmas <- function(var){
            median <- median(var)
            c(-4*sd(var)+median,-3*sd(var)+median,-2*sd(var)+median,-sd(var)+median, 
              median, 
              sd(var)+median, 2*sd(var)+median, 3*sd(var)+median, 4*sd(var)+median)
        }
        
        descr_plot <- ggplot(mapping = aes(x=variables))+
            geom_density(color="red", fill="deepskyblue1")+
            scale_x_continuous(expand = c(0, 0), limits=range(dens1$x), 
                               sec.axis = dup_axis(name="",
                                                   breaks = c(sigmas(variables)),
                                                   labels = c(expression(paste(-4, sigma)),
                                                              expression(paste(-3, sigma)),
                                                              expression(paste(-2, sigma)),
                                                              expression(paste(-1, sigma)),
                                                              expression(paste(0, sigma)),
                                                              expression(paste(1, sigma)),
                                                              expression(paste(2, sigma)),
                                                              expression(paste(3, sigma)),
                                                              expression(paste(4, sigma)))))+
            scale_y_continuous(expand = c(0, 0))+
            theme_classic()+
            theme(axis.text.y=element_blank(),
                  axis.line.y=element_blank(),
                  axis.ticks.y=element_blank(),
                  axis.title.y = element_blank(),
                  panel.grid.major.x = element_line(linetype = "longdash", color = "black"))+
            geom_area(data = with(dens1, data.frame(x, y))[pos_median,],
                      aes(x=x, y=y),
                      fill="dodgerblue4")+
            geom_vline(xintercept = c(min(variables), 
                                      quantile(variables, probs = c(.25,.75)), 
                                      max(variables)), 
                       linetype="twodash", color = "blue")+
            geom_vline(xintercept = sigmas(variables), linetype="dashed", color="darkorange2")+labs(x="")
        
        measures <- data.frame(Min=min(variables), Q1=quantile(variables, .25), Median=quantile(variables, .5),
                                   Q3=quantile(variables, .75), Max=max(variables), SD=sd(variables),
                                   Kurtosis=kurtosis(variables), Skweness=skewness(variables)) %>% 
            mutate_all(round, 2) %>% 
            ggtexttable(., rows = NULL, 
                        theme = ttheme("mBlue"))
        
        ggarrange(descr_plot, measures,
                  ncol = 1, nrow = 2,
                  heights = c(3, 0.5))
    }
    
    lapply(vars, plot_fun)
}
k <- descriptive_plot(datos, var1, var3) 
k
```



